
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Gallery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
        }
        .image-carousel {
            position: relative;
            overflow: hidden;
            border-radius: 10px;
        }
        .carousel-container {
            display: flex;
            transition: transform 0.3s ease;
        }
        .carousel-image {
            min-width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 50%;
        }
        .carousel-nav.prev { left: 10px; }
        .carousel-nav.next { right: 10px; }
        .carousel-dots {
            text-align: center;
            margin-top: 10px;
        }
        .dot {
            height: 10px;
            width: 10px;
            margin: 0 5px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .dot.active { background-color: #667eea; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-store me-2"></i>Product Manager
            </a>
            
        </div>
    </nav>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
      <div class="container">
        <a class="navbar-brand fw-bold" href="/master">
          <i class="fas fa-store me-2"></i>Product Manager
        </a>
        <% if (user && user.isAdmin) { %>
        <a href="/product/new" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>Add Product
        </a>
        <% } %>
        <div class="ms-auto">
          <a href="/cart" class="btn btn-outline-primary me-2 position-relative">
            <i class="fas fa-shopping-cart"></i> Cart
            <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size:0.8em;">0</span>
          </a>
          <a href="/wishlist" class="btn btn-outline-warning text-dark position-relative">
            <i class="fas fa-heart"></i> Wishlist
            <span id="wishlist-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size:0.8em;">0</span>
          </a>
        </div>
      </div>
    </nav>
    <div id="flash-message" style="display:none;"></div>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="text-white mb-4 text-center">
                    <i class="fas fa-boxes me-3"></i>Product Gallery
                </h1>
            </div>
        </div>

        <% if (products.length === 0) { %>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card text-center p-5">
                        <i class="fas fa-box-open fa-5x text-muted mb-3"></i>
                        <h3 class="text-muted">No Products Yet</h3>
                        <p class="text-muted mb-4">Start by adding your first product!</p>
                        <a href="/product/new" class="btn btn-primary btn-lg">
                            <i class="fas fa-plus me-2"></i>Create First Product
                        </a><form method="post" action="">
                          <fieldset>
                          <legend></legend>
                            <div>
                              <label for=""></label>
                              <input id="" type="text" name="">
                            </div>
                            
                            <input type="submit">
                          </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        <% } else { %>
            <div class="row">
                <% products.forEach(product => { %>
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card h-100">
                            <% if (product.ProductImages && product.ProductImages.length > 0) { %>
                                <div class="image-carousel" data-product-id="<%= product.id %>">
                                    <div class="carousel-container">
                                        <% product.ProductImages.forEach((image, index) => { %>
                                            <img src="/uploads/<%= image.filename %>" 
                                                 alt="<%= product.name %>" 
                                                 class="carousel-image"
                                                 data-image-id="<%= image.id %>">
                                        <% }) %>
                                    </div>
                                    <% if (product.ProductImages.length > 1) { %>
                                        <button class="carousel-nav prev" onclick="previousImage(<%= product.id %>)">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="carousel-nav next" onclick="nextImage(<%= product.id %>)">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    <% } %>
                                </div>
                                <% if (product.ProductImages.length > 1) { %>
                                    <div class="carousel-dots">
                                        <% product.ProductImages.forEach((image, index) => { %>
                                            <span class="dot <%= index === 0 ? 'active' : '' %>" 
                                                  onclick="goToImage(<%= product.id %>, <%= index %>)"></span>
                                        <% }) %>
                                    </div>
                                <% } %>
                            <% } else { %>
                                <div class="d-flex align-items-center justify-content-center" style="height: 200px; background: #f8f9fa;">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                </div>
                            <% } %>
                            
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title"><%= product.name %></h5>
                                <p class="card-text text-success fw-bold fs-4">$<%= product.price %></p>
                                <div class="mt-auto">
                                    <div class="btn-group w-100 mb-2" role="group">
                                        <a href="/product/<%= product.id %>/edit" class="btn btn-outline-primary">
                                            <i class="fas fa-edit me-1"></i>Edit
                                        </a>
                                        <button class="btn btn-outline-success" onclick="addImages(<%= product.id %>)">
                                            <i class="fas fa-plus me-1"></i>Add Images
                                        </button>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary mb-1" id="cart-btn-<%= product.id %>" data-id="<%= product.id %>" data-name="<%= product.name %>" data-price="<%= product.price %>" onclick="handleCartButton(this)">
                                            <i class="fas fa-cart-plus me-1"></i>Add to Cart
                                        </button>
                                        <button class="btn btn-warning text-white" data-id="<%= product.id %>" data-name="<%= product.name %>" data-price="<%= product.price %>" onclick="addToWishlistBtn(this)">
                                            <i class="fas fa-heart me-1"></i>Add to Wishlist
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } %>

        <input type="file" id="imageInput" multiple accept="image/*" style="display: none;" onchange="uploadImages()">
    </div>
    <script>
    // Cart and Wishlist logic (localStorage for demo)
    function showFlashMessage(msg, type = 'success') {
      const flash = document.getElementById('flash-message');
      flash.textContent = msg;
      flash.className = `alert alert-${type}`;
      flash.style.display = 'block';
      setTimeout(() => { flash.style.display = 'none'; }, 2000);
    }
    function handleCartButton(btn) {
      const id = parseInt(btn.dataset.id);
      const name = btn.dataset.name;
      const price = parseFloat(btn.dataset.price);
      let cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const idx = cart.findIndex(item => item.id === id);
      if (btn.textContent.trim().toLowerCase().includes('add to cart')) {
        if (idx > -1) {
          cart[idx].qty += 1;
        } else {
          cart.push({ id, name, price, qty: 1 });
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartWishlistCounts();
        showFlashMessage('Added to cart!', 'success');
        btn.innerHTML = '<i class="fas fa-arrow-right me-1"></i>Proceed to Cart';
      } else {
        window.location.href = '/cart';
      }
    }
    function addToWishlistBtn(btn) {
      const id = parseInt(btn.dataset.id);
      const name = btn.dataset.name;
      const price = parseFloat(btn.dataset.price);
      let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
      if (!wishlist.find(item => item.id === id)) {
        wishlist.push({ id, name, price });
        localStorage.setItem('wishlist', JSON.stringify(wishlist));
        updateCartWishlistCounts();
        showFlashMessage('Added to wishlist!', 'success');
      } else {
        showFlashMessage('Already in wishlist!', 'warning');
      }
    }
    let currentProductId = null;
    function addImages(productId) {
        currentProductId = productId;
        document.getElementById('imageInput').click();
    }
    function uploadImages() {
        const fileInput = document.getElementById('imageInput');
        const files = fileInput.files;
        if (files.length > 0 && currentProductId) {
            const formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append('images', files[i]);
            }
            fetch(`/product/${currentProductId}`, {
                method: 'PUT',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            })
            .catch(error => console.error('Error:', error));
        }
        fileInput.value = '';
        currentProductId = null;
    }

    // Carousel logic
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.image-carousel').forEach(function(carousel) {
            setupCarousel(carousel);
        });
    });

    function setupCarousel(carousel) {
        const container = carousel.querySelector('.carousel-container');
        const images = container.querySelectorAll('.carousel-image');
        const dots = carousel.parentElement.querySelectorAll('.dot');
        let currentIndex = 0;

        // Store current index in DOM for each carousel
        carousel.dataset.currentIndex = 0;

        function showImage(index) {
            container.style.transform = `translateX(-${index * 100}%)`;
            carousel.dataset.currentIndex = index;
            if (dots.length) {
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            }
        }

        carousel.previousImage = function() {
            let idx = parseInt(carousel.dataset.currentIndex, 10);
            idx = (idx - 1 + images.length) % images.length;
            showImage(idx);
        };

        carousel.nextImage = function() {
            let idx = parseInt(carousel.dataset.currentIndex, 10);
            idx = (idx + 1) % images.length;
            showImage(idx);
        };

        carousel.goToImage = function(index) {
            showImage(index);
        };

        showImage(0);
    }

    function previousImage(productId) {
        const carousel = document.querySelector(`.image-carousel[data-product-id="${productId}"]`);
        if (carousel && carousel.previousImage) carousel.previousImage();
    }

    function nextImage(productId) {
        const carousel = document.querySelector(`.image-carousel[data-product-id="${productId}"]`);
        if (carousel && carousel.nextImage) carousel.nextImage();
    }

    function goToImage(productId, index) {
        const carousel = document.querySelector(`.image-carousel[data-product-id="${productId}"]`);
        if (carousel && carousel.goToImage) carousel.goToImage(index);
    }

    // Update cart/wishlist count badges
    function updateCartWishlistCounts() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
      const cartCount = cart.reduce((sum, item) => sum + item.qty, 0);
      const wishlistCount = wishlist.length;
      const cartBadge = document.getElementById('cart-count');
      const wishlistBadge = document.getElementById('wishlist-count');
      if (cartBadge) cartBadge.textContent = cartCount;
      if (wishlistBadge) wishlistBadge.textContent = wishlistCount;
    }
    document.addEventListener('DOMContentLoaded', updateCartWishlistCounts);
    // Also update after add
    window.handleCartButton = handleCartButton;
    window.addToWishlistBtn = addToWishlistBtn;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Gallery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
        }
        .image-carousel {
            position: relative;
            overflow: hidden;
            border-radius: 10px;
        }
        .carousel-container {
            display: flex;
            transition: transform 0.3s ease;
        }
        .carousel-image {
            min-width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 50%;
        }
        .carousel-nav.prev { left: 10px; }
        .carousel-nav.next { right: 10px; }
        .carousel-dots {
            text-align: center;
            margin-top: 10px;
        }
        .dot {
            height: 10px;
            width: 10px;
            margin: 0 5px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .dot.active { background-color: #667eea; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-store me-2"></i>Product Manager
            </a>
            
        </div>
    </nav>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
      <div class="container">
        <a class="navbar-brand fw-bold" href="/master">
          <i class="fas fa-store me-2"></i>Product Manager
        </a>
        <a href="/product/new" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Add Product
            </a>
        <div class="ms-auto">
          <a href="/cart" class="btn btn-outline-primary me-2 position-relative">
            <i class="fas fa-shopping-cart"></i> Cart
            <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size:0.8em;display:none;">0</span>
          </a>
          <a href="/wishlist" class="btn btn-outline-warning text-dark position-relative">
            <i class="fas fa-heart"></i> Wishlist
            <span id="wishlist-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size:0.8em;display:none;">0</span>
          </a>
        </div>
      </div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="text-white mb-4 text-center">
                    <i class="fas fa-boxes me-3"></i>Product Gallery
                </h1>
            </div>
        </div>

        <% if (products.length === 0) { %>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card text-center p-5">
                        <i class="fas fa-box-open fa-5x text-muted mb-3"></i>
                        <h3 class="text-muted">No Products Yet</h3>
                        <p class="text-muted mb-4">Start by adding your first product!</p>
                        <a href="/product/new" class="btn btn-primary btn-lg">
                            <i class="fas fa-plus me-2"></i>Create First Product
                        </a>
                    </div>
                </div>
            </div>
        <% } else { %>
            <div class="row">
                <% products.forEach(product => { %>
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card h-100">
                            <% if (product.ProductImages && product.ProductImages.length > 0) { %>
                                <div class="image-carousel" data-product-id="<%= product.id %>">
                                    <div class="carousel-container">
                                        <% product.ProductImages.forEach((image, index) => { %>
                                            <img src="/uploads/<%= image.filename %>" 
                                                 alt="<%= product.name %>" 
                                                 class="carousel-image"
                                                 data-image-id="<%= image.id %>">
                                        <% }) %>
                                    </div>
                                    <% if (product.ProductImages.length > 1) { %>
                                        <button class="carousel-nav prev" onclick="previousImage(<%= product.id %>)">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="carousel-nav next" onclick="nextImage(<%= product.id %>)">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    <% } %>
                                </div>
                                <% if (product.ProductImages.length > 1) { %>
                                    <div class="carousel-dots">
                                        <% product.ProductImages.forEach((image, index) => { %>
                                            <span class="dot <%= index === 0 ? 'active' : '' %>" 
                                                  onclick="goToImage(<%= product.id %>, <%= index %>)"></span>
                                        <% }) %>
                                    </div>
                                <% } %>
                            <% } else { %>
                                <div class="d-flex align-items-center justify-content-center" style="height: 200px; background: #f8f9fa;">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                </div>
                            <% } %>
                            
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title"><%= product.name %></h5>
                                <p class="card-text text-success fw-bold fs-4">$<%= product.price %></p>
                                <div class="mt-auto">
                                    <div class="btn-group w-100 mb-2" role="group">
                                        <a href="/product/<%= product.id %>/edit" class="btn btn-outline-primary">
                                            <i class="fas fa-edit me-1"></i>Edit
                                        </a>
                                        <button class="btn btn-outline-success" onclick="addImages(<%= product.id %>)">
                                            <i class="fas fa-plus me-1"></i>Add Images
                                        </button>
                                    </div>
                                     <div class="d-grid gap-2">
                                        <button class="btn btn-primary mb-1" data-id="<%= product.id %>" data-name="<%= product.name %>" data-price="<%= product.price %>" onclick="addToCartBtn(this)">
                                            <i class="fas fa-cart-plus me-1"></i>Add to Cart
                                        </button>
                                        <button class="btn btn-success mb-1" data-id="<%= product.id %>" data-name="<%= product.name %>" data-price="<%= product.price %>" onclick="buyNowBtn(this)">
                                            <i class="fas fa-bolt me-1"></i>Buy This Product
                                        </button>
                                        <button class="btn btn-warning text-white" data-id="<%= product.id %>" data-name="<%= product.name %>" data-price="<%= product.price %>" onclick="addToWishlistBtn(this)">
                                            <i class="fas fa-heart me-1"></i>Add to Wishlist
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } %>

        <input type="file" id="imageInput" multiple accept="image/*" style="display: none;" onchange="uploadImages()">
    </div>
    <script>
    // Cart and Wishlist logic (localStorage for demo)
    function addToCartBtn(btn) {
        const id = parseInt(btn.dataset.id);
        const name = btn.dataset.name;
        const price = parseFloat(btn.dataset.price);
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const idx = cart.findIndex(item => item.id === id);
        if (idx > -1) {
            cart[idx].qty += 1;
        } else {
            cart.push({ id, name, price, qty: 1 });
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        alert('Added to cart!');
    }
    function buyNowBtn(btn) {
        addToCartBtn(btn);
        window.location.href = '/cart';
    }
    function addToWishlistBtn(btn) {
        const id = parseInt(btn.dataset.id);
        const name = btn.dataset.name;
        const price = parseFloat(btn.dataset.price);
        let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
        if (!wishlist.find(item => item.id === id)) {
            wishlist.push({ id, name, price });
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            alert('Added to wishlist!');
        } else {
            alert('Already in wishlist!');
        }
    }
    let currentProductId = null;
    function addImages(productId) {
        currentProductId = productId;
        document.getElementById('imageInput').click();
    }
    function uploadImages() {
        const fileInput = document.getElementById('imageInput');
        const files = fileInput.files;
        if (files.length > 0 && currentProductId) {
            const formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append('images', files[i]);
            }
            fetch(`/product/${currentProductId}`, {
                method: 'PUT',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            })
            .catch(error => console.error('Error:', error));
        }
        fileInput.value = '';
        currentProductId = null;
    }

    // Carousel logic
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.image-carousel').forEach(function(carousel) {
            setupCarousel(carousel);
        });
    });

    function setupCarousel(carousel) {
        const container = carousel.querySelector('.carousel-container');
        const images = container.querySelectorAll('.carousel-image');
        const dots = carousel.parentElement.querySelectorAll('.dot');
        let currentIndex = 0;

        // Store current index in DOM for each carousel
        carousel.dataset.currentIndex = 0;

        function showImage(index) {
            container.style.transform = `translateX(-${index * 100}%)`;
            carousel.dataset.currentIndex = index;
            if (dots.length) {
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            }
        }

        carousel.previousImage = function() {
            let idx = parseInt(carousel.dataset.currentIndex, 10);
            idx = (idx - 1 + images.length) % images.length;
            showImage(idx);
        };

        carousel.nextImage = function() {
            let idx = parseInt(carousel.dataset.currentIndex, 10);
            idx = (idx + 1) % images.length;
            showImage(idx);
        };

        carousel.goToImage = function(index) {
            showImage(index);
        };

        showImage(0);
    }

    function previousImage(productId) {
        const carousel = document.querySelector(`.image-carousel[data-product-id="${productId}"]`);
        if (carousel && carousel.previousImage) carousel.previousImage();
    }

    function nextImage(productId) {
        const carousel = document.querySelector(`.image-carousel[data-product-id="${productId}"]`);
        if (carousel && carousel.nextImage) carousel.nextImage();
    }

    function goToImage(productId, index) {
        const carousel = document.querySelector(`.image-carousel[data-product-id="${productId}"]`);
        if (carousel && carousel.goToImage) carousel.goToImage(index);
    }

    // Update cart/wishlist count badges
    function updateCartWishlistCounts() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
      const cartCount = cart.reduce((sum, item) => sum + item.qty, 0);
      const wishlistCount = wishlist.length;
      const cartBadge = document.getElementById('cart-count');
      const wishlistBadge = document.getElementById('wishlist-count');
      if (cartCount > 0) {
        cartBadge.textContent = cartCount;
        cartBadge.style.display = 'inline-block';
      } else {
        cartBadge.style.display = 'none';
      }
      if (wishlistCount > 0) {
        wishlistBadge.textContent = wishlistCount;
        wishlistBadge.style.display = 'inline-block';
      } else {
        wishlistBadge.style.display = 'none';
      }
    }
    document.addEventListener('DOMContentLoaded', updateCartWishlistCounts);
    // Also update after add
    window.addToCartBtn = function(btn) {
      // ...existing code...
      const id = parseInt(btn.dataset.id);
      const name = btn.dataset.name;
      const price = parseFloat(btn.dataset.price);
      let cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const idx = cart.findIndex(item => item.id === id);
      if (idx > -1) {
        cart[idx].qty += 1;
      } else {
        cart.push({ id, name, price, qty: 1 });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      alert('Added to cart!');
      updateCartWishlistCounts();
    }
    window.buyNowBtn = function(btn) {
      window.addToCartBtn(btn);
      window.location.href = '/cart';
    }
    window.addToWishlistBtn = function(btn) {
      const id = parseInt(btn.dataset.id);
      const name = btn.dataset.name;
      const price = parseFloat(btn.dataset.price);
      let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
      if (!wishlist.find(item => item.id === id)) {
        wishlist.push({ id, name, price });
        localStorage.setItem('wishlist', JSON.stringify(wishlist));
        alert('Added to wishlist!');
        updateCartWishlistCounts();
      } else {
        alert('Already in wishlist!');
      }
    }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Cart/Wishlist navigation (demo) -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
      <div class="container">
        <a class="navbar-brand fw-bold" href="/master">
          <i class="fas fa-store me-2"></i>Product Manager
        </a>
        <div class="ms-auto">
          <a href="/cart" class="btn btn-outline-primary me-2"><i class="fas fa-shopping-cart"></i> Cart</a>
          <a href="/wishlist" class="btn btn-outline-warning text-dark"><i class="fas fa-heart"></i> Wishlist</a>
        </div>
      </div>
    </nav>
</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Gallery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
        }
        .image-carousel {
            position: relative;
            overflow: hidden;
            border-radius: 10px;
        }
        .carousel-container {
            display: flex;
            transition: transform 0.3s ease;
        }
        .carousel-image {
            min-width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 50%;
        }
        .carousel-nav.prev { left: 10px; }
        .carousel-nav.next { right: 10px; }
        .carousel-dots {
            text-align: center;
            margin-top: 10px;
        }
        .dot {
            height: 10px;
            width: 10px;
            margin: 0 5px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .dot.active { background-color: #667eea; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-store me-2"></i>Product Manager
            </a>
            <a href="/product/new" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Add Product
            </a>
        </div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="text-white mb-4 text-center">
                    <i class="fas fa-boxes me-3"></i>Product Gallery
                </h1>
            </div>
        </div>

        <% if (products.length === 0) { %>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card text-center p-5">
                        <i class="fas fa-box-open fa-5x text-muted mb-3"></i>
                        <h3 class="text-muted">No Products Yet</h3>
                        <p class="text-muted mb-4">Start by adding your first product!</p>
                        <a href="/product/new" class="btn btn-primary btn-lg">
                            <i class="fas fa-plus me-2"></i>Create First Product
                        </a>
                    </div>
                </div>
            </div>
        <% } else { %>
            <div class="row">
                <% products.forEach(product => { %>
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card h-100">
                            <% if (product.ProductImages && product.ProductImages.length > 0) { %>
                                <div class="image-carousel" data-product-id="<%= product.id %>">
                                    <div class="carousel-container">
                                        <% product.ProductImages.forEach((image, index) => { %>
                                            <img src="/uploads/<%= image.filename %>" 
                                                 alt="<%= product.name %>" 
                                                 class="carousel-image"
                                                 data-image-id="<%= image.id %>">
                                        <% }) %>
                                    </div>
                                    <% if (product.ProductImages.length > 1) { %>
                                        <button class="carousel-nav prev" onclick="previousImage(<%= product.id %>)">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="carousel-nav next" onclick="nextImage(<%= product.id %>)">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    <% } %>
                                </div>
                                <% if (product.ProductImages.length > 1) { %>
                                    <div class="carousel-dots">
                                        <% product.ProductImages.forEach((image, index) => { %>
                                            <span class="dot <%= index === 0 ? 'active' : '' %>" 
                                                  onclick="goToImage(<%= product.id %>, <%= index %>)"></span>
                                        <% }) %>
                                    </div>
                                <% } %>
                            <% } else { %>
                                <div class="d-flex align-items-center justify-content-center" style="height: 200px; background: #f8f9fa;">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                </div>
                            <% } %>
                            
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title"><%= product.name %></h5>
                                <p class="card-text text-success fw-bold fs-4">$<%= product.price %></p>
                                <div class="mt-auto">
                                    <div class="btn-group w-100" role="group">
                                        <a href="/product/<%= product.id %>/edit" class="btn btn-outline-primary">
                                            <i class="fas fa-edit me-1"></i>Edit
                                        </a>
                                        <button class="btn btn-outline-success" onclick="addImages(<%= product.id %>)">
                                            <i class="fas fa-plus me-1"></i>Add Images
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } %>

        <input type="file" id="imageInput" multiple accept="image/*" style="display: none;" onchange="uploadImages()">
    </div>
    <script>
    let currentProductId = null;
    function addImages(productId) {
        currentProductId = productId;
        document.getElementById('imageInput').click();
    }
    function uploadImages() {
        const fileInput = document.getElementById('imageInput');
        const files = fileInput.files;
        if (files.length > 0 && currentProductId) {
            const formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append('images', files[i]);
            }
            fetch(`/product/${currentProductId}`, {
                method: 'PUT',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            })
            .catch(error => console.error('Error:', error));
        }
        fileInput.value = '';
        currentProductId = null;
    }

    // Carousel logic
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.image-carousel').forEach(function(carousel) {
            setupCarousel(carousel);
        });
    });

    function setupCarousel(carousel) {
        const container = carousel.querySelector('.carousel-container');
        const images = container.querySelectorAll('.carousel-image');
        const dots = carousel.parentElement.querySelectorAll('.dot');
        let currentIndex = 0;

        // Store current index in DOM for each carousel
        carousel.dataset.currentIndex = 0;

        function showImage(index) {
            container.style.transform = `translateX(-${index * 100}%)`;
            carousel.dataset.currentIndex = index;
            if (dots.length) {
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            }
        }

        carousel.previousImage = function() {
            let idx = parseInt(carousel.dataset.currentIndex, 10);
            idx = (idx - 1 + images.length) % images.length;
            showImage(idx);
        };

        carousel.nextImage = function() {
            let idx = parseInt(carousel.dataset.currentIndex, 10);
            idx = (idx + 1) % images.length;
            showImage(idx);
        };

        carousel.goToImage = function(index) {
            showImage(index);
        };

        showImage(0);
    }

    function previousImage(productId) {
        const carousel = document.querySelector(`.image-carousel[data-product-id="${productId}"]`);
        if (carousel && carousel.previousImage) carousel.previousImage();
    }

    function nextImage(productId) {
        const carousel = document.querySelector(`.image-carousel[data-product-id="${productId}"]`);
        if (carousel && carousel.nextImage) carousel.nextImage();
    }

    function goToImage(productId, index) {
        const carousel = document.querySelector(`.image-carousel[data-product-id="${productId}"]`);
        if (carousel && carousel.goToImage) carousel.goToImage(index);
    }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


